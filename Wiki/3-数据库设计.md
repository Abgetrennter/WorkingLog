# 3. 数据库设计

本项目不使用传统的关系型数据库（如 SQL Server/SQLite），而是采用 **文件型存储** 方案。

## 3.1 存储策略
- **格式**: Microsoft Excel Open XML Format (`.xlsx`)
- **分表策略**: 按月分文件，命名规则 `worklog_yyyyMM.xlsx` (e.g., `worklog_202512.xlsx`)
- **存储路径**: `./Data/` 目录

## 3.2 Excel 数据结构

每个 Excel 文件包含一个名为 `工作日志` 的 Sheet。

### 列定义
| 索引 | 列名 (Header) | 数据类型 | 说明 |
| :--- | :--- | :--- | :--- |
| 0 | 日期 | Date | 事项日期 (yyyy/MM/dd) |
| 1 | 标题 | String | 事项简述 |
| 2 | 内容 | String | 详细内容 (支持换行) |
| 3 | 分类ID | Integer | 分类名称的 FNV-1a 哈希值 (稳定ID) |
| 4 | 开始时间 | Time | HH:mm |
| 5 | 结束时间 | Time | HH:mm |
| 6 | 标签 | String | 逗号分隔的标签 |
| 7 | 排序 | Integer | 当日内的排序权重 |

### 特殊行结构
为了提升 Excel 的可读性，系统会在数据中插入特殊的**格式化行**，这些行在读取时会被解析并过滤。

1. **日期分隔行**:
   - **特征**: 跨列合并，背景加粗。
   - **内容格式**: `===== yyyy年MM月dd日 星期X =====`
   - **作用**: 视觉分割不同日期的日志块。

2. **当日总结行**:
   - **特征**: 位于某日数据块的最后一行。
   - **标题列**: 固定为 `"当日总结"`。
   - **内容列**: 存储当天的总结文本。

## 3.3 JSON 模板结构 (`templates.json`)

模板配置文件存储在 `./Templates/templates.json`。

```json
{
  "Templates": {
    "研发": {
      "CategoryTemplate": {
        "FormatTemplate": "【研发】{Content}",
        "Placeholders": { ... }
      }
    },
    "研发-后端": {
      "CategoryTemplate": {
        "FormatTemplate": "模块: {Module}\r\n进度: {Progress}",
        "Placeholders": {
          "Module": "text",
          "Progress": "select"
        },
        "Options": {
          "Progress": ["0%", "50%", "100%"]
        }
      }
    }
  }
}
```

### 字段说明
- **Templates**: 字典结构，Key 为分类路径（如 `研发-后端`）。
- **FormatTemplate**: 生成日志内容的模板字符串。
- **Placeholders**: 定义表单字段及其类型 (`text`, `textarea`, `select`, `datetime`, `checkbox`)。
- **Options**: 定义 `select` 类型的选项列表。
